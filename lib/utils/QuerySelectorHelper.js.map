{"version":3,"sources":["../../src/utils/querySelectorHelper.js"],"names":[],"mappings":"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","file":"querySelectorHelper.js","sourcesContent":["import { CssSelectorParser } from 'css-selector-parser';\nconst cssParser = new CssSelectorParser();\n\n/**\n * querySelectorHelper interface provides simple processing\n * of Element.querySelector method.\n */\n\n/**\n *\n * @param {Element} element\n * @param {string} query\n * @returns {Element|null}\n */\nexport function querySelector(element, query) {\n    let rules = cssParser.parse(query);\n\n    const iterator = processElement(element, rules);\n    const next = iterator.next();\n\n    if (next && next.value) {\n        return next.value;\n    }\n\n    return null;\n}\n\n/**\n  *\n  * @param {Element} element\n  * @param {string} query\n  * @returns {Element[]}\n  */\nexport function querySelectorAll(element, query) {\n    let rules = cssParser.parse(query);\n\n    const result = [];\n    for (let element of processElement(element, rules)) {\n        result.push(element);\n    }\n\n    return result;\n}\n\n/**\n * Function processes one element using current rule\n *\n * @param element\n * @param rules\n * @returns {boolean}\n */\nfunction* processElement(element, rules) {\n    for (let child of element.children) {\n        for (let matchElement of processRules(child, rules)) {\n            yield matchElement;\n        }\n\n        for (let matchElement of processElement(child, rules)) {\n            yield matchElement;\n        }\n    }\n}\n\n/**\n * @param {Element} element\n * @param {Object} rules\n * @returns {boolean}\n */\nfunction processRules(element, rules) {\n    if (rules.type === 'selectors') {\n        return processSelectors(element, rules.selectors);\n    } else if (rules.type === 'ruleSet') {\n        return processRule(element, rules.rule);\n    }\n}\n\n/**\n * @param {Element} element\n * @param {Object} rule\n * @returns {boolean}\n */\nfunction processRule(element, rule) {\n    return processSelectors(element, [{ rule }]);\n}\n\n/**\n * @param {Element} element\n * @param {Object[]} selectors\n * @returns {boolean}\n */\nfunction* processSelectors(element, selectors) {\n    for (let selector of selectors) {\n        const rule = selector.rule;\n\n        if (!matchRule(element, rule)) {\n            continue;\n        }\n\n        if (!rule.hasOwnProperty('rule')) {\n            yield element;\n            return;\n        }\n\n        for (let childMatch of processElement(element, { type: 'ruleSet', rule: rule.rule })) {\n            yield childMatch;\n        }\n\n        return;\n    }\n}\n\nfunction matchRule(element, rule) {\n    if (rule.hasOwnProperty('tagName') && element.tagName !== rule.tagName) {\n        return false;\n    }\n\n    if (rule.hasOwnProperty('classNames')) {\n        if (!rule.classNames.every(name => element.classList.contains(name))) {\n            return false;\n        }\n    }\n\n    if (rule.hasOwnProperty('attrs')) {\n        if (!rule.attrs.every(attr => {\n            switch (attr.operator) {\n                case undefined:\n                    return element.hasAttribute(attr.name);\n                case '=':\n                    return element.getAttribute(attr.name) === attr.value;\n                default:\n                    throw new Error('Unsupported attribute operator ' + attr.operator);\n            }\n        })) {\n            return false;\n        }\n    }\n\n    return true;\n}\n"]}